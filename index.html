<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#040426">
    <title>Magische Karten</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
    <style>
        :root {
            --pop-red: #990000;
            --pop-red-bright: #ff0000;
            --pop-yellow: #ffd700;
            --pop-green: #006400;
            --pop-green-bright: #00ff00;
            --pop-blue: #0000cc;
            --pop-blue-bright: #00ffff;
            --pop-black: #000000;
            --bg-dark-blue: #040426;
        }

        body {
            margin: 0; padding: 10px;
            background-color: var(--bg-dark-blue);
            background-image: url('data:image/svg+xml;utf8,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="4" fill="%234da6ff"/><circle cx="45" cy="15" r="4" fill="%23ffffff"/><circle cx="15" cy="45" r="4" fill="%23ff66b3"/><circle cx="45" cy="45" r="4" fill="%239933ff"/></svg>');
            background-size: 60px 60px; font-family: 'Bangers', cursive;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; overflow: hidden; box-sizing: border-box;
            gap: 10px; /* Bringt alle Elemente näher zusammen */
        }

        /* Buttons näher an der Karte */
        .controls { display: flex; gap: 8px; z-index: 100; width: 100%; justify-content: center; margin-bottom: 5px; }
        .cat-btn {
            padding: 12px 8px; font-family: 'Bangers', cursive; font-size: 18px;
            border: 4px solid var(--pop-black); cursor: pointer; text-transform: uppercase;
            box-shadow: 4px 4px 0 var(--pop-black); transition: 0.1s; color: white;
            -webkit-text-stroke: 1px var(--pop-black); flex: 1; max-width: 105px; text-align: center;
        }
        #btn-drinnen { background-color: var(--pop-green); }
        #btn-drinnen.active { background-color: var(--pop-green-bright); transform: translateY(2px); box-shadow: 2px 2px 0 var(--pop-black); }
        #btn-draussen { background-color: var(--pop-red); }
        #btn-draussen.active { background-color: var(--pop-red-bright); transform: translateY(2px); box-shadow: 2px 2px 0 var(--pop-black); }
        #btn-lernen { background-color: var(--pop-blue); }
        #btn-lernen.active { background-color: var(--pop-blue-bright); transform: translateY(2px); box-shadow: 2px 2px 0 var(--pop-black); }

        .deck-container { display: flex; justify-content: center; align-items: center; width: 100%; position: relative; height: 420px; }
        .deck { position: relative; width: 280px; height: 390px; perspective: 1200px; }
        .card-container { position: absolute; width: 100%; height: 100%; transform-style: preserve-3d; transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1); }
        .card {
            position: absolute; width: 100%; height: 100%; border-radius: 15px;
            backface-visibility: hidden; display: flex; align-items: center; justify-content: center;
            text-align: center; border: 5px solid var(--pop-black); box-shadow: 8px 8px 0px var(--pop-black); background-color: #fff;
        }
        .card-back { background-color: #0000ff; background-image: radial-gradient(var(--pop-black) 20%, transparent 21%); background-size: 15px 15px; z-index: 2; }
        .card-back::after { content: '★'; font-size: 100px; color: var(--pop-yellow); -webkit-text-stroke: 3px var(--pop-black); text-shadow: 5px 5px 0 var(--pop-black); }
        .card-front { transform: rotateY(180deg); z-index: 1; padding: 40px; box-sizing: border-box; }
        
        /* Text zentral in der Karte */
        .text-content { font-size: 34px; line-height: 1.1; text-transform: uppercase; word-break: break-word; z-index: 5; position: relative; }
        
        /* Grosses Herz, Schaufel etc. */
        .suit { position: absolute; font-size: 85px; color: var(--pop-red); -webkit-text-stroke: 2px var(--pop-black); text-shadow: 2px 2px 0 var(--pop-black); z-index: 1; }
        .top-left { top: 10px; left: 10px; }
        .bottom-right { bottom: 10px; right: 10px; transform: rotate(180deg); }

        #comic-overlay {
            position: fixed; top: 50%; left: 50%; pointer-events: none; opacity: 0; z-index: 3000;
            font-size: 25vw; color: var(--pop-yellow); -webkit-text-stroke: 2vw var(--pop-black);
            text-shadow: 1vw 1vw 0 var(--pop-black); transform: translate(-50%, -50%) scale(0);
        }
        .comic-active { animation: comic-impact 1.1s forwards; }
        @keyframes comic-impact {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0) rotate(-20deg); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.4) rotate(10deg); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(2.2) rotate(30deg); }
        }

        /* GO Button näher an Karte */
        #go-btn { margin-top: 5px; padding: 15px 80px; background-color: var(--pop-yellow); font-size: 40px; border: 5px solid var(--pop-black); box-shadow: 6px 6px 0 var(--pop-black); cursor: pointer; font-family: 'Bangers'; text-transform: uppercase; }
        #go-btn:active { transform: translate(3px, 3px); box-shadow: 3px 3px 0 var(--pop-black); }

        /* Mischel-Animation im Vordergrund */
        .shuffle { animation: shuffle-anim 0.4s ease-in-out infinite; z-index: 500 !important; }
        @keyframes shuffle-anim { 
            0%, 100% { transform: translateX(0) scale(1); } 
            50% { transform: translateX(110px) rotate(8deg) scale(1.05); } 
        }
        .drawn { transform: scale(1.08) translateY(-10px) rotateY(180deg) !important; z-index: 1000 !important; }
    </style>
</head>
<body>
    <div class="controls">
        <button class="cat-btn active" id="btn-drinnen" onclick="setCategory('drinnen')">Drinnen</button>
        <button class="cat-btn" id="btn-draussen" onclick="setCategory('draussen')">Draussen</button>
        <button class="cat-btn" id="btn-lernen" onclick="setCategory('lernen')">Lernen</button>
    </div>

    <div class="deck-container">
        <div class="deck" id="deck"></div>
    </div>

    <div id="comic-overlay">POW!</div>
    <button id="go-btn" onclick="drawCard()">GO</button>

    <script>
        const rawData = {
            drinnen: ["Hörspiel hören", "Hörbuch hören", "Lieblingssendung schauen", "Comic lesen", "Spannendes Buch lesen", "Lego-Stadt bauen", "Fantasiefigur erfinden", "Geschichte schreiben", "Tagebuch führen", "Zeichnen oder malen", "Basteln mit Karton", "Recyclingmaterial basteln", "Origami falten", "Puzzle lösen", "Gesellschaftsspiel", "Kartentrick lernen", "Zaubertrick vorführen", "Jonglieren üben", "Instrument spielen", "Lied singen", "Tanz erfinden", "Foto machen", "Kurzen Film drehen", "Zimmer umgestalten", "Etwas reparieren", "Modell bauen", "Experiment machen", "Quiz spielen", "Rätsel lösen", "Koch- oder Backhilfe", "Anleitung schreiben", "Spiel erklären", "Präsentation planen", "Eigene Idee umsetzen", "Mini-Projekt starten", "Kreative Challenge"],
            draussen: ["Draussen frei spielen", "Boggia spielen", "Velofahren", "Skateboard fahren", "Spaziergang machen", "Wald erkunden", "Park entdecken", "Tiere beobachten", "Pflanzen bestimmen", "Blätter sammeln", "Steine sammeln", "Naturtagebuch führen", "Schatzsuche machen", "Abfall sammeln", "Müll sortieren", "Umweltplakat", "Kreidezeichnungen", "Demonstration", "Museum besuchen", "Hindernisparcours", "Picknick machen", "Draussen lesen", "Draussen malen", "Foto-Challenge", "Wolken beobachten", "Sterne zählen", "Wetter beobachten", "Blumen pflanzen", "Ins Kino gehen", "Vögel beobachten", "Nachbarn grüssen", "Nachbarn klingeln", "Freundin anrufen", "Mini-Interview", "Kleine Aufführung", "Abenteuer-Spiel"],
            lernen: ["Sachbuch lesen", "Wissensvideo schauen", "Dokumentation schauen", "Thema recherchieren", "Kurzen Vortrag halten", "Referat vorbereiten", "Mindmap erstellen", "Quiz erfinden", "Quiz lösen", "Logikrätsel lösen", "Knobelaufgabe", "Mathe-Spiel spielen", "Lern-App nutzen", "Vokabeln lernen", "Fremdsprache hören", "Fremdsprache sprechen", "Experiment planen", "Experiment auswerten", "Notizen machen", "Diagramm zeichnen", "Zeitachse erstellen", "Sachthema erklären", "Lernplakat gestalten", "Lernkarteikarten", "Zusammenfassung", "Präsentation halten", "Lernspiel erklären", "Anderen beibringen", "Interview planen", "Interview führen", "Fragen formulieren", "Diskussion führen", "Meinung begründen", "Lernziel festlegen", "Lernprojekt planen", "Lernprojekt fertig"]
        };

        let currentCategory = 'drinnen';
        let pools = { drinnen: [], draussen: [], lernen: [] };
        const comicWords = ["BOOM!", "POW!", "ZAP!", "WOW!", "CRACK!"];
        const suits = ["♥", "♦", "♣", "♠"];

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function refillPool(cat) { pools[cat] = shuffle([...rawData[cat]]); }

        function setCategory(cat) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${cat}`).classList.add('active');
            createDeck();
        }

        function createDeck() {
            const deck = document.getElementById('deck');
            deck.innerHTML = '';
            for (let i = 5; i > 0; i--) {
                const div = document.createElement('div');
                div.className = 'card-container';
                div.style.transform = `translateZ(${-i * 4}px) rotate(${Math.random() * 4 - 2}deg)`;
                div.innerHTML = `<div class="card card-back"></div><div class="card card-front"></div>`;
                deck.appendChild(div);
            }
        }

        function drawCard() {
            const btn = document.getElementById('go-btn');
            if (btn.disabled) return;
            btn.disabled = true;

            // Bestehende offene Karte entfernen, damit Mischeln im Vordergrund steht
            createDeck();

            if (pools[currentCategory].length === 0) refillPool(currentCategory);
            
            const cardText = pools[currentCategory].pop();
            const cards = document.querySelectorAll('.card-container');
            
            // Mischel-Animation starten
            cards.forEach((c, i) => setTimeout(() => c.classList.add('shuffle'), i * 30));

            setTimeout(() => {
                cards.forEach(c => c.classList.remove('shuffle'));
                const last = cards[cards.length - 1];
                const suit = suits[Math.floor(Math.random() * 4)];
                last.querySelector('.card-front').innerHTML = `
                    <div class="suit top-left">${suit}</div>
                    <div class="text-content">${cardText}</div>
                    <div class="suit bottom-right">${suit}</div>`;
                last.classList.add('drawn');
                
                if (Math.random() > 0.85) {
                    const ov = document.getElementById('comic-overlay');
                    ov.innerText = comicWords[Math.floor(Math.random() * comicWords.length)];
                    ov.classList.add('comic-active');
                    setTimeout(() => ov.classList.remove('comic-active'), 1100);
                }
                btn.disabled = false;
            }, 800);
        }

        window.onload = () => {
            Object.keys(rawData).forEach(refillPool);
            createDeck();
        };
    </script>
</body>
</html>
