<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#040426">
    <title>Magische Karten</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
    <style>
        :root {
            --pop-red: #990000;
            --pop-red-bright: #ff0000; /* Knalliges Comic-Rot */
            --pop-yellow: #ffd700;
            --pop-green: #006400;
            --pop-green-bright: #00ff00;
            --pop-blue-btn: #0000cc;
            --pop-blue-bright: #00ffff; /* Knalliges Electric Blue */
            --pop-black: #000000;
            --bg-dark-blue: #040426;
        }

        body {
            margin: 0;
            background-color: var(--bg-dark-blue);
            background-image: url('data:image/svg+xml;utf8,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="5.5" fill="%234da6ff"/><circle cx="45" cy="15" r="5.5" fill="%23ffffff"/><circle cx="15" cy="45" r="5.5" fill="%23ff66b3"/><circle cx="45" cy="45" r="5.5" fill="%239933ff"/></svg>');
            background-size: 60px 60px;
            color: var(--pop-black);
            font-family: 'Bangers', cursive;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
        }

        /* Kategorie-Buttons vergrössert und positioniert */
        .controls {
            display: flex; gap: 12px; margin-bottom: 25px; z-index: 100;
        }
        .cat-btn {
            padding: 15px 25px; font-family: 'Bangers', cursive; font-size: 22px;
            border: 4px solid var(--pop-black); cursor: pointer; text-transform: uppercase;
            box-shadow: 5px 5px 0 var(--pop-black); transition: 0.1s;
            color: white; -webkit-text-stroke: 1.5px var(--pop-black);
        }
        
        #btn-drinnen { background: var(--pop-green); }
        #btn-drinnen.active { background: var(--pop-green-bright); box-shadow: 2px 2px 0 var(--pop-black); transform: translateY(3px); }
        
        #btn-draussen { background: var(--pop-red); }
        #btn-draussen.active { background: var(--pop-red-bright); box-shadow: 2px 2px 0 var(--pop-black); transform: translateY(3px); }
        
        #btn-lernen { background: var(--pop-blue-btn); }
        #btn-lernen.active { background: var(--pop-blue-bright); box-shadow: 2px 2px 0 var(--pop-black); transform: translateY(3px); }

        /* Karten-Stapel */
        .deck { position: relative; width: 280px; height: 390px; perspective: 1200px; }
        .card-container {
            position: absolute; width: 100%; height: 100%;
            transform-style: preserve-3d; transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .card {
            position: absolute; width: 100%; height: 100%; border-radius: 15px;
            backface-visibility: hidden; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 25px;
            text-align: center; box-sizing: border-box; border: 5px solid var(--pop-black);
            box-shadow: 8px 8px 0px var(--pop-black); background-color: #fff;
        }
        .card-back {
            background-color: #0000ff;
            background-image: radial-gradient(var(--pop-black) 20%, transparent 21%);
            background-size: 15px 15px; z-index: 2;
        }
        .card-back::after {
            content: '★'; font-size: 100px; color: var(--pop-yellow);
            -webkit-text-stroke: 3px var(--pop-black); text-shadow: 5px 5px 0 var(--pop-black);
        }
        .card-front {
            background-image: radial-gradient(rgba(230, 0, 0, 0.1) 15%, transparent 16%);
            background-size: 12px 12px; color: var(--pop-black);
            transform: rotateY(180deg); z-index: 1; font-size: 34px; line-height: 1.15;
            text-transform: uppercase; hyphens: auto; -webkit-hyphens: auto; word-break: break-word;
        }
        .text-content { max-width: 100%; display: flex; align-items: center; justify-content: center; min-height: 200px; }
        .suit { position: absolute; font-size: 48px; color: var(--pop-red); -webkit-text-stroke: 2px var(--pop-black); text-shadow: 2px 2px 0 var(--pop-black); }
        .top-left { top: 15px; left: 15px; }
        .bottom-right { bottom: 15px; right: 15px; transform: rotate(180deg); }

        /* Comic-Effekt (Optimierte Schlag-Animation) */
        #comic-overlay {
            position: absolute; pointer-events: none; opacity: 0; z-index: 2000;
            font-size: 85px; color: var(--pop-yellow); -webkit-text-stroke: 3.5px var(--pop-black);
            text-shadow: 6px 6px 0 var(--pop-black); transform: scale(0);
        }
        @keyframes comic-impact {
            0% { opacity: 0; transform: scale(0) rotate(-20deg); }
            10% { opacity: 1; transform: scale(1.5) rotate(15deg); }
            20% { transform: scale(1.4) rotate(-10deg) translateX(5px); }
            30% { transform: scale(1.5) rotate(10deg) translateX(-5px); }
            80% { opacity: 1; transform: scale(1.3) rotate(5deg); }
            100% { opacity: 0; transform: scale(1.1) rotate(25deg); }
        }
        .comic-active { animation: comic-impact 1.2s cubic-bezier(0.17, 0.67, 0.83, 0.67) forwards; }

        /* GO Button */
        #go-btn {
            margin-top: 40px; padding: 20px 70px; background-color: var(--pop-yellow);
            color: var(--pop-black); border: 5px solid var(--pop-black); 
            font-family: 'Bangers', cursive; font-size: 36px; cursor: pointer; 
            text-transform: uppercase; letter-spacing: 3px; transition: 0.1s;
            box-shadow: 7px 7px 0px var(--pop-black); z-index: 100;
        }
        #go-btn:active { transform: translate(4px, 4px); box-shadow: 3px 3px 0px var(--pop-black); }
        #go-btn:disabled { opacity: 0.5; }

        .shuffle { animation: shuffle-move 0.4s ease-in-out infinite; }
        @keyframes shuffle-move { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(120px) rotate(10deg); } }
        .drawn { transform: scale(1.1) translateY(-25px) rotateY(180deg) !important; z-index: 1000 !important; box-shadow: 20px 20px 0px rgba(0,0,0,0.5) !important; }
    </style>
</head>
<body>
    <div class="controls">
        <button class="cat-btn active" id="btn-drinnen" onclick="setCategory('drinnen')">Drinnen</button>
        <button class="cat-btn" id="btn-draussen" onclick="setCategory('draussen')">Draussen</button>
        <button class="cat-btn" id="btn-lernen" onclick="setCategory('lernen')">Lernen</button>
    </div>

    <div class="deck" id="deck"></div>
    <div id="comic-overlay">BOOM!</div>

    <button id="go-btn" onclick="drawCard()">GO</button>

    <script>
        const data = {
            drinnen: ["Hörspiel hören", "Hörbuch hören", "Lieblingssendung schauen", "Comic lesen", "Spannendes Buch lesen", "Lego-Stadt bauen", "Fantasiefigur erfinden", "Geschichte schreiben", "Tagebuch führen", "Zeichnen oder malen", "Basteln mit Karton", "Basteln mit Recyclingmaterial", "Origami falten", "Puzzle lösen", "Gesellschaftsspiel spielen", "Kartentrick lernen", "Zaubertrick vorführen", "Jonglieren üben", "Musikinstrument spielen", "Lied singen", "Tanz erfinden", "Foto machen", "Kurzen Film drehen", "Zimmer umgestalten", "Etwas reparieren", "Modell bauen", "Experiment durchführen", "Quiz spielen", "Rätsel lösen", "Kochhilfe leisten", "Anleitung schreiben", "Spiel erklären", "Präsentation vorbereiten", "Eigene Idee umsetzen", "Mini-Projekt starten", "Challenge erfinden"],
            draussen: ["Draussen frei spielen", "Boggia spielen", "Velofahren", "Skateboard fahren", "Spaziergang machen", "Wald erkunden", "Park entdecken", "Tiere beobachten", "Pflanzen bestimmen", "Blätter sammeln", "Steine sammeln", "Naturtagebuch führen", "Schatzsuche machen", "Abfall sammeln", "Müll sortieren", "Umweltplakat gestalten", "Kreidezeichnungen", "Demonstration teilnehmen", "Museum besuchen", "Hindernisparcours bauen", "Picknick", "Draussen lesen", "Draussen malen", "Foto-Challenge", "Wolken beobachten", "Sterne zählen", "Wetter beobachten", "Blumen pflanzen", "Ins Kino gehen", "Vögel beobachten", "Nachbarn grüssen", "Nachbarn klingeln", "Freundin anrufen", "Mini-Interview", "Aufführung draussen", "Abenteuer-Spiel"],
            lernen: ["Sachbuch lesen", "Wissensvideo schauen", "Dokumentation schauen", "Thema recherchieren", "Kurzen Vortrag halten", "Referat vorbereiten", "Mindmap erstellen", "Quiz erfinden", "Quiz lösen", "Logikrätsel lösen", "Knobelaufgabe", "Mathe-Spiel spielen", "Lern-App nutzen", "Vokabeln lernen", "Fremdsprache hören", "Fremdsprache sprechen", "Experiment planen", "Experiment auswerten", "Beobachtungen notieren", "Diagramm zeichnen", "Zeitachse erstellen", "Sachthema erklären", "Lernplakat gestalten", "Lernkarteikarten", "Zusammenfassung", "Präsentation halten", "Lernspiel erklären", "Anderen beibringen", "Interview vorbereiten", "Interview durchführen", "Fragen formulieren", "Diskussion führen", "Meinung begründen", "Lernziel festlegen", "Lernprojekt planen", "Lernprojekt abschliessen"]
        };

        const comicWords = ["BOOM!", "POW!", "COOL!", "ZAP!", "CRACK!", "WOW!", "WAHHH!"];
        const suits = ["♥", "♦", "♣", "♠"];
        let currentCategory = 'drinnen';
        
        const deck = document.getElementById('deck');
        const goBtn = document.getElementById('go-btn');
        const comicOverlay = document.getElementById('comic-overlay');

        function setCategory(cat) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${cat}`).classList.add('active');
        }

        function playCardSound() {
            try {
                const context = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = context.createOscillator();
                const gain = context.createGain();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(150, context.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(40, context.currentTime + 0.1);
                gain.gain.setValueAtTime(0.5, context.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, context.currentTime + 0.15);
                oscillator.connect(gain); gain.connect(context.destination);
                oscillator.start(); oscillator.stop(context.currentTime + 0.15);
                if (navigator.vibrate) { navigator.vibrate(50); }
            } catch (e) {}
        }

        function triggerComicEffect() {
            if (Math.random() > 0.45) return; 
            const word = comic
